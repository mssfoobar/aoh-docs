"use strict";(self.webpackChunkaoh_documentation=self.webpackChunkaoh_documentation||[]).push([[5405],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>h});var a=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=a.createContext({}),c=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},p=function(e){var t=c(e.components);return a.createElement(l.Provider,{value:t},e.children)},u="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,l=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),u=c(n),m=r,h=u["".concat(l,".").concat(m)]||u[m]||d[m]||o;return n?a.createElement(h,i(i({ref:t},p),{},{components:n})):a.createElement(h,i({ref:t},p))}));function h(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,i=new Array(o);i[0]=m;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[u]="string"==typeof e?e:r,i[1]=s;for(var c=2;c<o;c++)i[c]=n[c];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},18679:(e,t,n)=>{n.d(t,{Z:()=>i});var a=n(67294),r=n(86010);const o="tabItem_Ymn6";function i(e){let{children:t,hidden:n,className:i}=e;return a.createElement("div",{role:"tabpanel",className:(0,r.Z)(o,i),hidden:n},t)}},34259:(e,t,n)=>{n.d(t,{Z:()=>m});var a=n(87462),r=n(67294),o=n(86010),i=n(51048),s=n(33609),l=n(1943),c=n(72957);const p="tabList__CuJ",u="tabItem_LNqP";function d(e){const{lazy:t,block:n,defaultValue:i,values:d,groupId:m,className:h}=e,k=r.Children.map(e.children,(e=>{if((0,r.isValidElement)(e)&&"value"in e.props)return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})),y=d??k.map((e=>{let{props:{value:t,label:n,attributes:a}}=e;return{value:t,label:n,attributes:a}})),v=(0,s.l)(y,((e,t)=>e.value===t.value));if(v.length>0)throw new Error(`Docusaurus error: Duplicate values "${v.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`);const f=null===i?i:i??k.find((e=>e.props.default))?.props.value??k[0].props.value;if(null!==f&&!y.some((e=>e.value===f)))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${f}" but none of its children has the corresponding value. Available values are: ${y.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);const{tabGroupChoices:g,setTabGroupChoices:b}=(0,l.U)(),[w,N]=(0,r.useState)(f),C=[],{blockElementScrollPositionUntilNextRender:O}=(0,c.o5)();if(null!=m){const e=g[m];null!=e&&e!==w&&y.some((t=>t.value===e))&&N(e)}const T=e=>{const t=e.currentTarget,n=C.indexOf(t),a=y[n].value;a!==w&&(O(t),N(a),null!=m&&b(m,String(a)))},j=e=>{let t=null;switch(e.key){case"Enter":T(e);break;case"ArrowRight":{const n=C.indexOf(e.currentTarget)+1;t=C[n]??C[0];break}case"ArrowLeft":{const n=C.indexOf(e.currentTarget)-1;t=C[n]??C[C.length-1];break}}t?.focus()};return r.createElement("div",{className:(0,o.Z)("tabs-container",p)},r.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,o.Z)("tabs",{"tabs--block":n},h)},y.map((e=>{let{value:t,label:n,attributes:i}=e;return r.createElement("li",(0,a.Z)({role:"tab",tabIndex:w===t?0:-1,"aria-selected":w===t,key:t,ref:e=>C.push(e),onKeyDown:j,onClick:T},i,{className:(0,o.Z)("tabs__item",u,i?.className,{"tabs__item--active":w===t})}),n??t)}))),t?(0,r.cloneElement)(k.filter((e=>e.props.value===w))[0],{className:"margin-top--md"}):r.createElement("div",{className:"margin-top--md"},k.map(((e,t)=>(0,r.cloneElement)(e,{key:t,hidden:e.props.value!==w})))))}function m(e){const t=(0,i.Z)();return r.createElement(d,(0,a.Z)({key:String(t)},e))}},77343:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>l,default:()=>m,frontMatter:()=>s,metadata:()=>c,toc:()=>u});var a=n(87462),r=(n(67294),n(3905)),o=n(34259),i=n(18679);const s={sidebar_position:1},l="Create a new service",c={unversionedId:"development/guides/services",id:"development/guides/services",title:"Create a new service",description:"This section provides step-by-step instructions on how you can create a new service in the AGIL Ops Hub framework.",source:"@site/docs/development/guides/services.md",sourceDirName:"development/guides",slug:"/development/guides/services",permalink:"/aoh-docs/docs/development/guides/services",draft:!1,editUrl:"https://github.com/mssfoobar/aoh-docs/tree/main/docs/development/guides/services.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1},sidebar:"development",previous:{title:"\ud83d\udcda Guides",permalink:"/aoh-docs/docs/category/-guides-2"},next:{title:"Projects",permalink:"/aoh-docs/docs/development/guides/infrastructure"}},p={},u=[{value:"Pre-requisites",id:"pre-requisites",level:2},{value:"Setting up the repository",id:"setting-up-the-repository",level:2},{value:"1. Create a new repository for your service from the template",id:"1-create-a-new-repository-for-your-service-from-the-template",level:3},{value:"1.1 Clone the repository",id:"11-clone-the-repository",level:4},{value:"1.2 Renaname the repository",id:"12-renaname-the-repository",level:4},{value:"1.2 Change the <code>.git</code> repository to your own new one",id:"12-change-the-git-repository-to-your-own-new-one",level:4},{value:"2. Create a Keycloak client for your service",id:"2-create-a-keycloak-client-for-your-service",level:3},{value:"2.1 Install <code>jq</code> if you don&#39;t have it (it is a json query)",id:"21-install-jq-if-you-dont-have-it-it-is-a-json-query",level:4},{value:"2.2 Prepare Keycloak client information",id:"22-prepare-keycloak-client-information",level:4},{value:"2.3 Prepare credentials to create Keycloak client",id:"23-prepare-credentials-to-create-keycloak-client",level:4},{value:"2.4",id:"24",level:4},{value:"3. Configure the Continuous Integration scripts for your service",id:"3-configure-the-continuous-integration-scripts-for-your-service",level:3},{value:"Service Endpoints",id:"service-endpoints",level:2},{value:"Accessing the table",id:"accessing-the-table",level:2}],d={toc:u};function m(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,a.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"create-a-new-service"},"Create a new service"),(0,r.kt)("p",null,"This section provides step-by-step instructions on how you can create a new service in the ",(0,r.kt)("inlineCode",{parentName:"p"},"AGIL Ops Hub")," framework."),(0,r.kt)("h2",{id:"pre-requisites"},"Pre-requisites"),(0,r.kt)("p",null,"Recommended Tools:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("a",{parentName:"p",href:"https://code.visualstudio.com/download"},"Visual Studio Code")),(0,r.kt)("p",{parentName:"li"},"A popular text editor with many integrations with the technologies we use. Alternatively, you may use your preferred\ntext editor."))),(0,r.kt)("p",null,"Required:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("a",{parentName:"p",href:"https://learn.microsoft.com/en-us/windows/wsl/install"},"Windows Subsystem for Linux (Ubuntu Distribution)")),(0,r.kt)("p",{parentName:"li"},"If you are running on a Windows system, you'll want to install the Ubuntu distribution of WSL\n(Windows Subsystem for Linux). This is because we'll be giving you Linux commands and scripts to\nsimplify/standardize the steps required to get the project up and running."),(0,r.kt)("p",{parentName:"li"},"If you are comfortable with running the equivalent commands on Windows, you may skip this requirement, however,\nwe have scripts/commands ready (e.g. curl-ing the Keycloak Admin API endpoints) for you to run in Linux that might\nbe troublesome to perform on Windows.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("a",{parentName:"p",href:"https://go.dev/"},"Go")),(0,r.kt)("p",{parentName:"li"},"Golang runtime required for development.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("a",{parentName:"p",href:"https://git-scm.com/downloads"},"Git")),(0,r.kt)("p",{parentName:"li"},"Our version control system for source code. This is installed in Ubuntu by default. If you're using Windows, please\ninstall it. You can use GitHub Desktop or your favourite GUI package for this as well."),(0,r.kt)("p",{parentName:"li"},(0,r.kt)("a",{parentName:"p",href:"https://learn.microsoft.com/en-us/windows/wsl/tutorials/wsl-git#git-credential-manager-setup"},"https://learn.microsoft.com/en-us/windows/wsl/tutorials/wsl-git#git-credential-manager-setup")),(0,r.kt)("p",{parentName:"li"},"If you're using WSL, follow the above tutorial to ensure ",(0,r.kt)("inlineCode",{parentName:"p"},"git")," in WSL works seamlessly with Windows. This means any\npassword you use when working with ",(0,r.kt)("inlineCode",{parentName:"p"},"git")," on Windows will also work in WSL.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("a",{parentName:"p",href:"https://www.docker.com/products/docker-desktop/"},"Docker Desktop")),(0,r.kt)("p",{parentName:"li"},"Contains the container run-time for container images as well as a user-interface for managing containers, and many\nmore additional features such as ",(0,r.kt)("inlineCode",{parentName:"p"},"docker-compose"),", etc.\nEven if you are extremely familiar with containerization,\n",(0,r.kt)("a",{parentName:"p",href:"https://www.docker.com/products/container-runtime/"},"Docker Engine")," alone will probably not be enough as we use\n",(0,r.kt)("inlineCode",{parentName:"p"},"docker-compose"),"."))),(0,r.kt)("h2",{id:"setting-up-the-repository"},"Setting up the repository"),(0,r.kt)("admonition",{type:"caution"},(0,r.kt)("p",{parentName:"admonition"},"Members contributing directly to AGIL Ops Hub will should have access to the repositories in ",(0,r.kt)("inlineCode",{parentName:"p"},"mssfoobar"),". Members of\nother projects will require access to the same repository in a different organisation."),(0,r.kt)("p",{parentName:"admonition"},"If you do not have access to the following repositories, approach the maintainers of ",(0,r.kt)("inlineCode",{parentName:"p"},"AOH")," to request for access.")),(0,r.kt)("h3",{id:"1-create-a-new-repository-for-your-service-from-the-template"},"1. Create a new repository for your service from the template"),(0,r.kt)("p",null,"The following repositories exist as GitHub templates, if you are hosting your source code on GitHub, you can go to\nthe respective repository links and click ",(0,r.kt)("inlineCode",{parentName:"p"},"Use this template")," to create a new repository directly from the template,\notherwise, you may use the steps below to clone and create a new ",(0,r.kt)("inlineCode",{parentName:"p"},"git")," repository."),(0,r.kt)("h4",{id:"11-clone-the-repository"},"1.1 Clone the repository"),(0,r.kt)("p",null,"Refer to the pre-requisite section on how to set up ",(0,r.kt)("inlineCode",{parentName:"p"},"git")," in WSL if your credentials in Windows are not being recognized\nin WSL."),(0,r.kt)(o.Z,{mdxType:"Tabs"},(0,r.kt)(i.Z,{value:"1",label:"AGIL Ops Hub",default:!0,mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"git clone https://github.com/mssfoobar/aoh-service-template\n"))),(0,r.kt)(i.Z,{value:"2",label:"Other Projects",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"git clone https://github.com/DoisKoh/aoh-service-template\n")))),(0,r.kt)("h4",{id:"12-renaname-the-repository"},"1.2 Renaname the repository"),(0,r.kt)("p",null,"This example assumes you are creating a service called ",(0,r.kt)("inlineCode",{parentName:"p"},"solveallyourproblems"),". You should also replace ",(0,r.kt)("inlineCode",{parentName:"p"},"aoh")," with your project or\norganisation name."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"mv aoh-service-template aoh-solveallyourproblems\n")),(0,r.kt)("h4",{id:"12-change-the-git-repository-to-your-own-new-one"},"1.2 Change the ",(0,r.kt)("inlineCode",{parentName:"h4"},".git")," repository to your own new one"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"cd aoh-solveallyourproblems\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"rm -rf .git\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"git init\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"git checkout -b main\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"git add .\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'git commit -m "initial commit"\n')),(0,r.kt)("h3",{id:"2-create-a-keycloak-client-for-your-service"},"2. Create a Keycloak client for your service"),(0,r.kt)("p",null,"Your new service will need to authenticate itself with Keycloak in order to access other services in our system (e.g.\nto connect to Hasura to write or read data in the database). To do this, it needs to register itself with Keycloak as a\nnew client and exchange its credentials for an access token that must be sent with each request to other services."),(0,r.kt)("h4",{id:"21-install-jq-if-you-dont-have-it-it-is-a-json-query"},"2.1 Install ",(0,r.kt)("inlineCode",{parentName:"h4"},"jq")," if you don't have it (it is a json query)"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"sudo apt install jq\n")),(0,r.kt)("h4",{id:"22-prepare-keycloak-client-information"},"2.2 Prepare Keycloak client information"),(0,r.kt)("p",null,"Change the values for ",(0,r.kt)("inlineCode",{parentName:"p"},"clientId"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"name")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"description")," in the following command based on what you want your service\nto be called."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'jq \'.clientId = "aoh_solveallyourproblems" |\n .name = "AGIL Ops Hub Solve All Your Problems Service" |\n .description = "This service will solve all your problems."\' \\\n service_client_template.json > client_config.json\n')),(0,r.kt)("h4",{id:"23-prepare-credentials-to-create-keycloak-client"},"2.3 Prepare credentials to create Keycloak client"),(0,r.kt)("p",null,"For the following command, you will need to prepare 3 bits of information:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"the address to your Keycloak server (e.g. ",(0,r.kt)("a",{parentName:"li",href:"http://iam.dev.aoh"},"http://iam.dev.aoh"),")"),(0,r.kt)("li",{parentName:"ul"},"the username of the Keycloak admin account"),(0,r.kt)("li",{parentName:"ul"},"the password of the Keycloak admin account")),(0,r.kt)("p",null,"The command will log you in to Keycloak and retrieve an access token, then use that access token to create a client for\nyour new service based on the ",(0,r.kt)("inlineCode",{parentName:"p"},"client_config.json")," file we just created in 1.2.2."),(0,r.kt)("p",null,"Create a new Keycloak client for your service"),(0,r.kt)("p",null,"Replace the ",(0,r.kt)("inlineCode",{parentName:"p"},"[username]")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"[password]")," with your appropriate Keycloak credentials."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"USERNAME=[username]\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"PASSWORD=[password]\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'TOKEN="$(curl -s -X POST -H "Content-Type: application/x-www-form-urlencoded" \\\n-d "username=$USERNAME&password=$PASSWORD&grant_type=password&client_id=admin-cli" \\\nhttp://iam.dev2.ar2/realms/master/protocol/openid-connect/token | jq -r ".access_token")"\n')),(0,r.kt)("h4",{id:"24"},"2.4"),(0,r.kt)("hr",null),(0,r.kt)("h3",{id:"3-configure-the-continuous-integration-scripts-for-your-service"},"3. Configure the Continuous Integration scripts for your service"),(0,r.kt)("admonition",{type:"danger"},(0,r.kt)("p",{parentName:"admonition"},"zzzz")),(0,r.kt)("h1",{id:"general-development"},"General Development"),(0,r.kt)("h2",{id:"service-endpoints"},"Service Endpoints"),(0,r.kt)("p",null,"Services often need to call other services, and this is almost always done with endpoints (URL's). Since these URL's\ncan change, we store them in a table in the database (in the future, we might have a more sophisticated service\ndiscovery mechanism, but for now, we register services to a table in the database and all services should call retrieve\nservice endpoints from this table - ",(0,r.kt)("inlineCode",{parentName:"p"},"aoh_system.endpoint"),")."),(0,r.kt)("h2",{id:"accessing-the-table"},"Accessing the table"),(0,r.kt)("p",null,"Minimally, your services will still need to take in environment variables to connect to the data endpoint that provides\nthe service endpoints, and also connect to the IAM server to retrieve your access token to grant you access to the\nsystem - so these items must still be passed to your service in some configurable way - likely environment variables:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Identity Access Management server URL"),(0,r.kt)("li",{parentName:"ul"},"Identity Access Management client credentials (client ID and secret)"),(0,r.kt)("li",{parentName:"ul"},"Data Endpoint URL (we use Hasura so it is a GraphQL endpoint URL)")),(0,r.kt)("p",null,"For details on how to connect to Keycloak to retrieve the access token, go to the ",(0,r.kt)("a",{parentName:"p",href:"/docs/iam/introduction"},"IAM section"),"."))}m.isMDXComponent=!0}}]);