"use strict";(self.webpackChunkaoh_documentation=self.webpackChunkaoh_documentation||[]).push([[6788],{39298:(e,o,n)=>{n.r(o),n.d(o,{assets:()=>l,contentTitle:()=>i,default:()=>h,frontMatter:()=>a,metadata:()=>t,toc:()=>c});var s=n(74848),r=n(28453);const a={sidebar_position:3},i="Roles & Groups",t={id:"iam/roles_and_groups",title:"Roles & Groups",description:"Keycloak has the concept of Roles and Groups; a user can have roles or groups, and a group can contain multiple roles.",source:"@site/docs/50_iam/30_roles_and_groups.md",sourceDirName:"50_iam",slug:"/iam/roles_and_groups",permalink:"/aoh-docs/docs/iam/roles_and_groups",draft:!1,unlisted:!1,editUrl:"https://github.com/mssfoobar/aoh-docs/tree/main/docs/50_iam/30_roles_and_groups.md",tags:[],version:"current",sidebarPosition:3,frontMatter:{sidebar_position:3},sidebar:"iam",previous:{title:"Administering OIDC Clients",permalink:"/aoh-docs/docs/iam/clients"}},l={},c=[{value:"Roles in AOH (AGIL Ops Hub)",id:"roles-in-aoh-agil-ops-hub",level:2},{value:"Creating a new role",id:"creating-a-new-role",level:2},{value:"Creating a role in Keycloak",id:"creating-a-role-in-keycloak",level:3},{value:"Creating a group in Keycloak",id:"creating-a-group-in-keycloak",level:3}];function d(e){const o={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(o.h1,{id:"roles--groups",children:"Roles & Groups"}),"\n",(0,s.jsx)(o.p,{children:"Keycloak has the concept of Roles and Groups; a user can have roles or groups, and a group can contain multiple roles."}),"\n",(0,s.jsx)(o.h2,{id:"roles-in-aoh-agil-ops-hub",children:"Roles in AOH (AGIL Ops Hub)"}),"\n",(0,s.jsxs)(o.p,{children:["As explained in the ",(0,s.jsx)(o.a,{href:"/docs/iam/introduction#authentication-in-agil-ops-hub",children:"introduction"}),", AGIL Ops Hub uses roles,\nand allows users have different roles depending on what team they are in. These roles are match the roles in Hasura\nand is used to evaluate permission policies that control what tables the user is allowed to access. Combined with\nHasura's custom check for permissions, we have the ability to very flexibly control what tables users are allowed to\naccess."]}),"\n",(0,s.jsx)(o.p,{children:"The roles in AGIL Ops Hub map directly to roles in Keycloak - they are the same. However, the way we use groups in\nkeycloak is the same as roles. This is due to a quirk of how Keycloak assigns attributes to users - it does not merge\nattributes from roles into the user attributes, but it does so from the groups. This means that if we want to create\ncustom claims based on the user's role by reading their role attributes, it won't work. This is why we put users in\ngroups as if they are their role."}),"\n",(0,s.jsxs)(o.p,{children:["However, we still have to give users a role, as users are only allowed to assume roles based on their\n",(0,s.jsx)(o.code,{children:"x-hasura-allowed-role"})," claim."]}),"\n",(0,s.jsx)(o.h2,{id:"creating-a-new-role",children:"Creating a new role"}),"\n",(0,s.jsx)(o.p,{children:"To create a new role, you must create both a role, and a matching group, and assign the `default-role`` attribute in\nthat group."}),"\n",(0,s.jsx)(o.h3,{id:"creating-a-role-in-keycloak",children:"Creating a role in Keycloak"}),"\n",(0,s.jsxs)(o.ol,{children:["\n",(0,s.jsxs)(o.li,{children:["Click ",(0,s.jsx)(o.code,{children:"Realm roles"})," on the left menu"]}),"\n",(0,s.jsxs)(o.li,{children:["Click ",(0,s.jsx)(o.code,{children:"Create role"})]}),"\n",(0,s.jsx)(o.li,{children:"Give the role a name and helpful description"}),"\n",(0,s.jsx)(o.li,{children:"Click save"}),"\n"]}),"\n",(0,s.jsx)(o.h3,{id:"creating-a-group-in-keycloak",children:"Creating a group in Keycloak"}),"\n",(0,s.jsxs)(o.ol,{children:["\n",(0,s.jsxs)(o.li,{children:["Click ",(0,s.jsx)(o.code,{children:"Groups"})," on the left"]}),"\n",(0,s.jsxs)(o.li,{children:["Click ",(0,s.jsx)(o.code,{children:"Create group"})]}),"\n",(0,s.jsx)(o.li,{children:"Give your group a name, this should match the role (to avoid confusion)"}),"\n",(0,s.jsx)(o.li,{children:"Click on your newly created group"}),"\n",(0,s.jsxs)(o.li,{children:["Click on the ",(0,s.jsx)(o.code,{children:"attributes"})," tab"]}),"\n",(0,s.jsxs)(o.li,{children:["Create a new key, value pair with the key as ",(0,s.jsx)(o.code,{children:"default-role"})," and the value as the name of your role"]}),"\n"]})]})}function h(e={}){const{wrapper:o}={...(0,r.R)(),...e.components};return o?(0,s.jsx)(o,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},28453:(e,o,n)=>{n.d(o,{R:()=>i,x:()=>t});var s=n(96540);const r={},a=s.createContext(r);function i(e){const o=s.useContext(a);return s.useMemo((function(){return"function"==typeof e?e(o):{...o,...e}}),[o,e])}function t(e){let o;return o=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),s.createElement(a.Provider,{value:o},e.children)}}}]);