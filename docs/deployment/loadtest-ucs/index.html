<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-deployment/loadtest-ucs" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.4.0">
<title data-rh="true">UCS/SFU Loadtesting | AGIL Ops Hub</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://mssfoobar.github.io/aoh-docs/docs/deployment/loadtest-ucs"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="UCS/SFU Loadtesting | AGIL Ops Hub"><meta data-rh="true" name="description" content="Objective: To stress test the SFU"><meta data-rh="true" property="og:description" content="Objective: To stress test the SFU"><link data-rh="true" rel="icon" href="/aoh-docs/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://mssfoobar.github.io/aoh-docs/docs/deployment/loadtest-ucs"><link data-rh="true" rel="alternate" href="https://mssfoobar.github.io/aoh-docs/docs/deployment/loadtest-ucs" hreflang="en"><link data-rh="true" rel="alternate" href="https://mssfoobar.github.io/aoh-docs/docs/deployment/loadtest-ucs" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/aoh-docs/releases/rss.xml" title="AGIL Ops Hub RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/aoh-docs/releases/atom.xml" title="AGIL Ops Hub Atom Feed">







<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css" integrity="sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM" crossorigin="anonymous"><link rel="stylesheet" href="/aoh-docs/assets/css/styles.51575d4a.css">
<script src="/aoh-docs/assets/js/runtime~main.e758c745.js" defer="defer"></script>
<script src="/aoh-docs/assets/js/main.3b5dd104.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"dark")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/aoh-docs/"><b class="navbar__title text--truncate">AGIL Ops Hub</b></a><a class="navbar__item navbar__link" href="/aoh-docs/releases">Releases</a><a class="navbar__item navbar__link" href="/aoh-docs/docs/overview/introduction">Overview</a><a class="navbar__item navbar__link" href="/aoh-docs/docs/development/introduction">Development</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/aoh-docs/docs/deployment/overview">Deployment</a><div class="navbar__item dropdown dropdown--hoverable"><a aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link" href="/aoh-docs/docs/deployment/loadtest-ucs">Modules</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/aoh-docs/docs/modules/iam/introduction">IAM</a></li><li><a class="dropdown__link" href="/aoh-docs/docs/modules/web/introduction">Web</a></li><li><a class="dropdown__link" href="/aoh-docs/docs/modules/ucs/introduction">UCS</a></li><li><a class="dropdown__link" href="/aoh-docs/docs/modules/gis/introduction">GIS</a></li><li><a class="dropdown__link" href="/aoh-docs/docs/modules/rnr/introduction">RNR</a></li><li><a class="dropdown__link" href="/aoh-docs/docs/modules/wfe/introduction">WFE</a></li></ul></div><a class="navbar__item navbar__link" href="/aoh-docs/docs/documentation/introduction">Documentation</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/aoh-docs/docs/overview/introduction">Next</a><a href="https://github.com/mssfoobar" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="navbarSearchContainer_Bca1"><div class="navbar__search"><span aria-label="expand searchbar" role="button" class="search-icon" tabindex="0"></span><input id="search_input_react" type="search" placeholder="Loading..." aria-label="Search" class="navbar__search-input search-bar" disabled=""></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/aoh-docs/docs/deployment/overview">Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/aoh-docs/docs/deployment/pre-requisites">Pre-requisites</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/aoh-docs/docs/category/infra-platform">Infra platform</a><button aria-label="Expand sidebar category &#x27;Infra platform&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/aoh-docs/docs/category/aoh-platform">AOH Platform</a><button aria-label="Expand sidebar category &#x27;AOH Platform&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/aoh-docs/docs/deployment/wrapup">Wrap up</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/aoh-docs/docs/deployment/loadtest">Loadtesting results</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/aoh-docs/docs/deployment/loadtest-ucs">UCS/SFU Loadtesting</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/aoh-docs/docs/deployment/maintenance">Maintenance</a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_xLCN"><div class="docItemContainer_jfFK"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/aoh-docs/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">UCS/SFU Loadtesting</span><meta itemprop="position" content="1"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><div class="row"><div class="col col--12"><h1>UCS/SFU Loadtesting</h1>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="objective-to-stress-test-the-sfu">Objective: To stress test the SFU<a class="hash-link" aria-label="Direct link to Objective: To stress test the SFU" title="Direct link to Objective: To stress test the SFU" href="/aoh-docs/docs/deployment/loadtest-ucs#objective-to-stress-test-the-sfu">​</a></h3>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="loadtest-targets">loadtest targets<a class="hash-link" aria-label="Direct link to loadtest targets" title="Direct link to loadtest targets" href="/aoh-docs/docs/deployment/loadtest-ucs#loadtest-targets">​</a></h3>
<p>Minimum Number of 1-1 video calls: 100
Minimum Number of streams: 200
Minimum Number of Users: 200</p>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="1-testing-setup">1 Testing setup<a class="hash-link" aria-label="Direct link to 1 Testing setup" title="Direct link to 1 Testing setup" href="/aoh-docs/docs/deployment/loadtest-ucs#1-testing-setup">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="aoh-cluster-setup-used-for-the-test">AOH Cluster setup used for the test<a class="hash-link" aria-label="Direct link to AOH Cluster setup used for the test" title="Direct link to AOH Cluster setup used for the test" href="/aoh-docs/docs/deployment/loadtest-ucs#aoh-cluster-setup-used-for-the-test">​</a></h3>
<p>Environment:                        dev2
Cloud provider:                     AWS
Number of Cores in the AOH cluster: 24
Number of nodes for cluster:        6
Number of cores for SFU:            4
Size of RAM per cluster:            375GB
Size of RAM pre node:               62GB
Storage class:                      HDD/ - 500MB/s</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="these-are-the-test-setup">These are the test setup<a class="hash-link" aria-label="Direct link to These are the test setup" title="Direct link to These are the test setup" href="/aoh-docs/docs/deployment/loadtest-ucs#these-are-the-test-setup">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="vm-instances-testing-machine">VM instances testing machine<a class="hash-link" aria-label="Direct link to VM instances testing machine" title="Direct link to VM instances testing machine" href="/aoh-docs/docs/deployment/loadtest-ucs#vm-instances-testing-machine">​</a></h3>
<p>Number of Cores: 4
RAM size: 16GB
storage class: 500MB/s</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="sfu-configuration">SFU configuration<a class="hash-link" aria-label="Direct link to SFU configuration" title="Direct link to SFU configuration" href="/aoh-docs/docs/deployment/loadtest-ucs#sfu-configuration">​</a></h3>
<p>maxbandwidth = 1500kbps
maxpackettrack = 500</p>
<p><img decoding="async" loading="lazy" alt="Message Bus" src="/aoh-docs/assets/images/TestSetup-587c1959b3d7d1fafccc5e7e878e78bc.png" width="482" height="511" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="additional-tools-used">Additional Tools used:<a class="hash-link" aria-label="Direct link to Additional Tools used:" title="Direct link to Additional Tools used:" href="/aoh-docs/docs/deployment/loadtest-ucs#additional-tools-used">​</a></h4>
<p>OBS (For Webcam simulation)
Firefox</p>
<p>Websites used for webcam simulation</p>
<ul>
<li><a href="https://www.clocktab.com/" target="_blank" rel="noopener noreferrer">https://www.clocktab.com/</a></li>
<li><a href="https://www.timeanddate.com/worldclock/" target="_blank" rel="noopener noreferrer">https://www.timeanddate.com/worldclock/</a></li>
<li><a href="https://www.changiairport.com/" target="_blank" rel="noopener noreferrer">https://www.changiairport.com/</a></li>
<li><a href="https://www.youtube.com/watch?v=LDU_Txk06tM" target="_blank" rel="noopener noreferrer">https://www.youtube.com/watch?v=LDU_Txk06tM</a></li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="actual-communication-model">actual communication model<a class="hash-link" aria-label="Direct link to actual communication model" title="Direct link to actual communication model" href="/aoh-docs/docs/deployment/loadtest-ucs#actual-communication-model">​</a></h4>
<p><img decoding="async" loading="lazy" alt="Message Bus" src="/aoh-docs/assets/images/MessageBus-857ab3ad3a2efc568900738b68224851.png" width="534" height="581" class="img_ev3q"></p>
<p>All clients will send their video stream to the SFU, and will receive streams from other users through the SFU.</p>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="2-test-steps">2 Test steps<a class="hash-link" aria-label="Direct link to 2 Test steps" title="Direct link to 2 Test steps" href="/aoh-docs/docs/deployment/loadtest-ucs#2-test-steps">​</a></h2>
<h3></h3>
<ol>
<li>VM is cloned with Firefox, OBS, webcam simulator stream installed</li>
<li>Firefox, OBS, webcam simulator stream is installed</li>
<li>Webcam simulator is started, OBS is started</li>
<li>1st User insteance is started up and logged in for Firefox, 1-1 video call is engaged with 2nd User</li>
<li>Step 4 is repeated for 4-6 times to spawn additional 1-1 calls with other VM/users</li>
<li>The process is repeated until the targetted number of users are spawned.</li>
</ol>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="3-results">3 Results<a class="hash-link" aria-label="Direct link to 3 Results" title="Direct link to 3 Results" href="/aoh-docs/docs/deployment/loadtest-ucs#3-results">​</a></h2>
<p><img decoding="async" loading="lazy" alt="Message Bus" src="/aoh-docs/assets/images/sfu_transmitt-1881d32fe85846b496f911b797a6a7bd.png" width="760" height="296" class="img_ev3q">
Figure 1a graph of transmitting network activity of SFU during the test</p>
<p><img decoding="async" loading="lazy" alt="Message Bus" src="/aoh-docs/assets/images/sfu_Receive-96ed81ef286fad40fc5455e2b0a74ab3.png" width="791" height="361" class="img_ev3q">
Figure 1b graph of receiving network activity of SFU during the test</p>
<p>From figure 1a and 1b, you can observe that for 100 pairs of 1-1 calls, the network required is about 15.7MB/s</p>
<p><img decoding="async" loading="lazy" alt="Message Bus" src="/aoh-docs/assets/images/SFU_CPU-1e69ca88b03b63fc1c2e93ea571d6c22.png" width="1446" height="393" class="img_ev3q">
Figure 2 CPU utilisation</p>
<p>From Figure 2, you can observe that the SFU is using about 1.8 CPU cores during the time where it is serving 100 pairs of 1-1 calls. Since each node has 4 cores, the utilisation rate is below 50%.</p>
<p><img decoding="async" loading="lazy" alt="Message Bus" src="/aoh-docs/assets/images/sfu_CLusterCPUload_totalCluster-6c0bcd96d8f107249ef7b9895fc1b6fd.png" width="853" height="352" class="img_ev3q">
Figure 3 total cluster load</p>
<p>From FIgure 3, you can observe that the total cluster load increased to 62.5% during the test. However, this is still under the 80% threshold, which is typically the benchmark used for load testing</p>
<p><img decoding="async" loading="lazy" alt="Message Bus" src="/aoh-docs/assets/images/sfu_Node_total_memory-7f98b038f9ccb15532180867ef45a89d.png" width="1437" height="285" class="img_ev3q">
Figure 4 total node memory usage
In Figure 4, you can observed that the memory consumption of the node has increased to 6.67GB.</p>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="3-observations">3 Observations<a class="hash-link" aria-label="Direct link to 3 Observations" title="Direct link to 3 Observations" href="/aoh-docs/docs/deployment/loadtest-ucs#3-observations">​</a></h2>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="for-how-much-each-stream-is-consuming-over-the-network-please-refer-to-appendix-b">For how much each stream is consuming over the network, please refer to Appendix B<a class="hash-link" aria-label="Direct link to For how much each stream is consuming over the network, please refer to Appendix B" title="Direct link to For how much each stream is consuming over the network, please refer to Appendix B" href="/aoh-docs/docs/deployment/loadtest-ucs#for-how-much-each-stream-is-consuming-over-the-network-please-refer-to-appendix-b">​</a></h4>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="some-statistic-for-the-sfu">some statistic for the sfu<a class="hash-link" aria-label="Direct link to some statistic for the sfu" title="Direct link to some statistic for the sfu" href="/aoh-docs/docs/deployment/loadtest-ucs#some-statistic-for-the-sfu">​</a></h4>
<ol>
<li>CPU only increased by 37.5% for the cluster with 100 pairs of 1-1 calls</li>
<li>Max CPU utilisaton for sfu pod/service: 50%</li>
<li>Max Memory utilitsation for sfu pod/service: 14%</li>
<li>Max Node CPU utilisation: 63.4%</li>
<li>Average Node memory utilisation: 51%</li>
</ol>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="appendix-a-obs-as-a-virtual-webcam">Appendix A OBS as a virtual webcam<a class="hash-link" aria-label="Direct link to Appendix A OBS as a virtual webcam" title="Direct link to Appendix A OBS as a virtual webcam" href="/aoh-docs/docs/deployment/loadtest-ucs#appendix-a-obs-as-a-virtual-webcam">​</a></h2>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="apart-from-steaming-a-pc-screen-to-major-streaming-sites--obs-can-emulate-a-webcam-onto-the-client-using-the-many-source-capture-tools-the-obs-offers-for-this-test-the-browser-capture-tool-allows-a-user-to-load-a-webpage-directly">Apart from steaming a PC screen to major streaming sites,  OBS can emulate a webcam onto the client using the many source capture tools the OBS offers. For this test, the browser capture tool allows a user to load a webpage directly.<a class="hash-link" aria-label="Direct link to Apart from steaming a PC screen to major streaming sites,  OBS can emulate a webcam onto the client using the many source capture tools the OBS offers. For this test, the browser capture tool allows a user to load a webpage directly." title="Direct link to Apart from steaming a PC screen to major streaming sites,  OBS can emulate a webcam onto the client using the many source capture tools the OBS offers. For this test, the browser capture tool allows a user to load a webpage directly." href="/aoh-docs/docs/deployment/loadtest-ucs#apart-from-steaming-a-pc-screen-to-major-streaming-sites--obs-can-emulate-a-webcam-onto-the-client-using-the-many-source-capture-tools-the-obs-offers-for-this-test-the-browser-capture-tool-allows-a-user-to-load-a-webpage-directly">​</a></h2>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="appendix-b-why-spawn-ec2-instance-instead-of-spawing-vms-on-local-servers">Appendix B why Spawn EC2 instance instead of spawing VMs on local servers<a class="hash-link" aria-label="Direct link to Appendix B why Spawn EC2 instance instead of spawing VMs on local servers" title="Direct link to Appendix B why Spawn EC2 instance instead of spawing VMs on local servers" href="/aoh-docs/docs/deployment/loadtest-ucs#appendix-b-why-spawn-ec2-instance-instead-of-spawing-vms-on-local-servers">​</a></h2>
<p>The bandwidth of the office to the wfm-qa environment is 99mbps. To prevent any bottle neck, it was decided to do future tests in the EC2 when possible.</p>
<p><img decoding="async" loading="lazy" alt="Message Bus" src="/aoh-docs/assets/images/MaxNetworkbandwidthNeededForTest-9d4371a23bc8e7bc1bfb75454552b5bc.png" width="954" height="227" class="img_ev3q">
Sample max network activity of 305 MBps recorded</p>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="appendix-b-testing-done-in-aws">Appendix B Testing done in AWS<a class="hash-link" aria-label="Direct link to Appendix B Testing done in AWS" title="Direct link to Appendix B Testing done in AWS" href="/aoh-docs/docs/deployment/loadtest-ucs#appendix-b-testing-done-in-aws">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="aoh-cluster-setup-used-for-the-test-1">AOH Cluster setup used for the test<a class="hash-link" aria-label="Direct link to AOH Cluster setup used for the test" title="Direct link to AOH Cluster setup used for the test" href="/aoh-docs/docs/deployment/loadtest-ucs#aoh-cluster-setup-used-for-the-test-1">​</a></h3>
<p>Environment:                        wfm-qa
Cloud provider:                     AWS
Number of Cores in the AOH cluster: 8
Number of nodes for cluster:        4
Number of cores for SFU:            2
Size of RAM:                        32GB
Storage class:                      gp3</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="these-are-the-test-setup-1">These are the test setup<a class="hash-link" aria-label="Direct link to These are the test setup" title="Direct link to These are the test setup" href="/aoh-docs/docs/deployment/loadtest-ucs#these-are-the-test-setup-1">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="ec2-instances-testing-machine">EC2 instances testing machine<a class="hash-link" aria-label="Direct link to EC2 instances testing machine" title="Direct link to EC2 instances testing machine" href="/aoh-docs/docs/deployment/loadtest-ucs#ec2-instances-testing-machine">​</a></h3>
<p>Number of Cores: 4
Class of EC2: t3a.xlarge
RAM size: 16GB
EBS class : gp2</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="sfu-configuration-1">SFU configuration<a class="hash-link" aria-label="Direct link to SFU configuration" title="Direct link to SFU configuration" href="/aoh-docs/docs/deployment/loadtest-ucs#sfu-configuration-1">​</a></h3>
<p>maxbandwidth = 1500kbps
maxpackettrack = 500</p>
<p><img decoding="async" loading="lazy" alt="Message Bus" src="/aoh-docs/assets/images/TestSetup-587c1959b3d7d1fafccc5e7e878e78bc.png" width="482" height="511" class="img_ev3q"></p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="additional-tools-used-1">Additional Tools used:<a class="hash-link" aria-label="Direct link to Additional Tools used:" title="Direct link to Additional Tools used:" href="/aoh-docs/docs/deployment/loadtest-ucs#additional-tools-used-1">​</a></h4>
<p>OBS (For Webcam simulation)
Firefox</p>
<p>Websites used for webcam simulation</p>
<ul>
<li><a href="https://www.clocktab.com/" target="_blank" rel="noopener noreferrer">https://www.clocktab.com/</a></li>
<li><a href="https://www.timeanddate.com/worldclock/" target="_blank" rel="noopener noreferrer">https://www.timeanddate.com/worldclock/</a></li>
<li><a href="https://www.changiairport.com/" target="_blank" rel="noopener noreferrer">https://www.changiairport.com/</a></li>
<li><a href="https://www.youtube.com/watch?v=LDU_Txk06tM" target="_blank" rel="noopener noreferrer">https://www.youtube.com/watch?v=LDU_Txk06tM</a></li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="actual-communication-model-1">actual communication model<a class="hash-link" aria-label="Direct link to actual communication model" title="Direct link to actual communication model" href="/aoh-docs/docs/deployment/loadtest-ucs#actual-communication-model-1">​</a></h4>
<p><img decoding="async" loading="lazy" alt="Message Bus" src="/aoh-docs/assets/images/MessageBus-857ab3ad3a2efc568900738b68224851.png" width="534" height="581" class="img_ev3q"></p>
<p>All clients will send their video stream to the SFU, and will receive streams from other users through the SFU.</p>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="2-test-steps-1">2 Test steps<a class="hash-link" aria-label="Direct link to 2 Test steps" title="Direct link to 2 Test steps" href="/aoh-docs/docs/deployment/loadtest-ucs#2-test-steps-1">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="-1"><a class="hash-link" aria-label="Direct link to -1" title="Direct link to -1" href="/aoh-docs/docs/deployment/loadtest-ucs#-1">​</a></h3>
<ol>
<li>EC2 of type t3a.xlarge is spawned</li>
<li>Firefox, OBS, webcam simulator stream is installed</li>
<li>Webcam simulator is started, OBS is started</li>
<li>1st User insteance is started up and logged in for Firefox, 1-1 video call is engaged with 2nd User</li>
<li>2nd User instance is started up and logged in in Firefox private mode. 1-1 vidoe call is engaged with 4th User</li>
<li>Another EC2 is spawned.</li>
<li>Firefox, OBS, webcam simulator stream is installed</li>
<li>Webcam simulator is started, OBS is started</li>
<li>3rd User insteance is started up and logged in for Firefox, 1-1 video call is engaged with 1st User</li>
<li>4th User instance is started up and logged in in Firefox private mode. 1-1 vidoe call is engaged with 2nd User</li>
<li>The process is repeated until the targetted number of users are spawned.</li>
</ol>
<p>However, due to  time and money constrain, the test was stopped on the forth day.</p>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="3-results-1">3 Results<a class="hash-link" aria-label="Direct link to 3 Results" title="Direct link to 3 Results" href="/aoh-docs/docs/deployment/loadtest-ucs#3-results-1">​</a></h2>
<p><img decoding="async" loading="lazy" alt="Message Bus" src="/aoh-docs/assets/images/Network_out_1835hrs_2Streams-06de7893d922e0f11f93eb2f9bad7a3b.png" width="1167" height="653" class="img_ev3q">
Figure 1a graph of EC2 with one or two streams output running</p>
<p><img decoding="async" loading="lazy" alt="Message Bus" src="/aoh-docs/assets/images/23thApril_2100hrs_100output-c977454ffc4ce893841d65b816d66c3e.png" width="1658" height="698" class="img_ev3q">
Figure 1b graph of EC2 with</p>
<p>From figure 1b,around 1835hrs on 23rd April, you can observe that most EC2s will converge to about 1.1MBps - 1.58MBps when two streams are up, and around 550kBps in Figure 1a when one steam upload is happening.
The total streams translate to 84 streams, with 27 EC2 with 2 streams, and 30 streams with 1 stream.</p>
<p><img decoding="async" loading="lazy" alt="Message Bus" src="/aoh-docs/assets/images/Network_out_1835hrs_2Streams-06de7893d922e0f11f93eb2f9bad7a3b.png" width="1167" height="653" class="img_ev3q">
Figure 2a graph of EC2 with one or two streams input running</p>
<p><img decoding="async" loading="lazy" alt="Message Bus" src="/aoh-docs/assets/images/Network_out_1835hrs_1Streams-bc930b07e7fd654dea41c5b19b6a90cf.png" width="1267" height="639" class="img_ev3q">
Figure 2b graph of EC2 with at least one streams input running</p>
<p>From Figure 2, around 1730hrs on 23rd April, you can observe that more tha 27 EC2s have bandwidth ingesion running at around 1.1MBps, which indicates that there are two streams running and 30 EC2s running from 200 - 600kBps, which indicates that it is running at least 1 stream. At this point of time there are at least 84 streams being ingested at the same time.</p>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="3-observations-1">3 Observations<a class="hash-link" aria-label="Direct link to 3 Observations" title="Direct link to 3 Observations" href="/aoh-docs/docs/deployment/loadtest-ucs#3-observations-1">​</a></h2>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="1-most-stream-are-around-200-600kb">1) Most stream are around 200-600kB.<a class="hash-link" aria-label="Direct link to 1) Most stream are around 200-600kB." title="Direct link to 1) Most stream are around 200-600kB." href="/aoh-docs/docs/deployment/loadtest-ucs#1-most-stream-are-around-200-600kb">​</a></h4>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="2-streams-dropdisconnects-after-sometime">2) streams drop/disconnects after sometime<a class="hash-link" aria-label="Direct link to 2) streams drop/disconnects after sometime" title="Direct link to 2) streams drop/disconnects after sometime" href="/aoh-docs/docs/deployment/loadtest-ucs#2-streams-dropdisconnects-after-sometime">​</a></h4>
<p><img decoding="async" loading="lazy" alt="Message Bus" src="/aoh-docs/assets/images/StreamDropsDecreasing-e6dafb6b50855c985aab04baadf12812.png" width="1713" height="662" class="img_ev3q">
Figure 3a Network graph showing streams dropping as time passes</p>
<p><img decoding="async" loading="lazy" alt="Message Bus" src="/aoh-docs/assets/images/Screenshot2024-04-24110016-1b8d4813a0d991daf7c8c84414829816.png" width="917" height="689" class="img_ev3q">
Figure 3b</p>
<p><img decoding="async" loading="lazy" alt="Message Bus" src="/aoh-docs/assets/images/Screenshot2024-04-24102156-756c2828372367ee5d1b574a1825db32.png" width="911" height="681" class="img_ev3q">
Figure 3c</p>
<p>From figure 3b and 3c, you can observe two different clients displaying the last frame of the video call that they received.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="3-it-seems-that-the-sfu--converges-to-cpu-34">3) It seems that the SFU  converges to CPU 34%<a class="hash-link" aria-label="Direct link to 3) It seems that the SFU  converges to CPU 34%" title="Direct link to 3) It seems that the SFU  converges to CPU 34%" href="/aoh-docs/docs/deployment/loadtest-ucs#3-it-seems-that-the-sfu--converges-to-cpu-34">​</a></h4>
<p><img decoding="async" loading="lazy" alt="Message Bus" src="/aoh-docs/assets/images/SFU_CPU_vs_numberOfCalls-ba3145415107103aa64516e709da0131.png" width="1715" height="669" class="img_ev3q">
Figure 4 CPU comsumption of SFU over time</p>
<p>From Figure 4, you can observe the CPU usage of the SFU over the testing period.
-- the Highest usage recorded is about 50%, which translate to a consumption of 1 core, and about 80 streams
-- As streams starts to drop, the CPU consumption will converge to the 34%. (log shaped graph)</p>
<p><img decoding="async" loading="lazy" alt="Message Bus" src="/aoh-docs/assets/images/Day1_80streams-6607fffaf66c5226fd5d7a828cb6de8e.png" width="1334" height="683" class="img_ev3q">
Figure 5a 30 ec2 of 2 streams at the end of day 1</p>
<p><img decoding="async" loading="lazy" alt="Message Bus" src="/aoh-docs/assets/images/Day1_80streams_part2-7f6ed1ddb76c324fc42db93115424150.png" width="1334" height="678" class="img_ev3q">
Figure 5b 20 ec2 of 1 streams at the end of day 1</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="some-statistic-for-the-sfu-1">some statistic for the sfu<a class="hash-link" aria-label="Direct link to some statistic for the sfu" title="Direct link to some statistic for the sfu" href="/aoh-docs/docs/deployment/loadtest-ucs#some-statistic-for-the-sfu-1">​</a></h4>
<ol>
<li>Max UDP byte process per seconds handled by SFU (up/down): 562kbps</li>
<li>Max CPU utilisaton for sfu pod/service: 50%</li>
<li>Max Memory utilitsation for sfu pod/service: 14%</li>
<li>Max Node CPU utilisation: 63.4%</li>
<li>Average Node memory utilisation: 51%</li>
</ol></div></div></div><div class="col col--12"><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/mssfoobar/aoh-docs/tree/main/docs/30_deployment/95-loadtest-ucs.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></div></article><div class="col col--12"><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/aoh-docs/docs/deployment/loadtest"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Loadtesting results</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/aoh-docs/docs/deployment/maintenance"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Maintenance</div></a></nav></div></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a class="table-of-contents__link toc-highlight" href="/aoh-docs/docs/deployment/loadtest-ucs#objective-to-stress-test-the-sfu">Objective: To stress test the SFU</a></li><li><a class="table-of-contents__link toc-highlight" href="/aoh-docs/docs/deployment/loadtest-ucs#loadtest-targets">loadtest targets</a></li><li><a class="table-of-contents__link toc-highlight" href="/aoh-docs/docs/deployment/loadtest-ucs#1-testing-setup">1 Testing setup</a><ul><li><a class="table-of-contents__link toc-highlight" href="/aoh-docs/docs/deployment/loadtest-ucs#aoh-cluster-setup-used-for-the-test">AOH Cluster setup used for the test</a></li></ul></li><li><a class="table-of-contents__link toc-highlight" href="/aoh-docs/docs/deployment/loadtest-ucs#these-are-the-test-setup">These are the test setup</a><ul><li><a class="table-of-contents__link toc-highlight" href="/aoh-docs/docs/deployment/loadtest-ucs#vm-instances-testing-machine">VM instances testing machine</a></li><li><a class="table-of-contents__link toc-highlight" href="/aoh-docs/docs/deployment/loadtest-ucs#sfu-configuration">SFU configuration</a></li></ul></li><li><a class="table-of-contents__link toc-highlight" href="/aoh-docs/docs/deployment/loadtest-ucs#2-test-steps">2 Test steps</a></li><li><a class="table-of-contents__link toc-highlight" href="/aoh-docs/docs/deployment/loadtest-ucs#3-results">3 Results</a></li><li><a class="table-of-contents__link toc-highlight" href="/aoh-docs/docs/deployment/loadtest-ucs#3-observations">3 Observations</a></li><li><a class="table-of-contents__link toc-highlight" href="/aoh-docs/docs/deployment/loadtest-ucs#appendix-a-obs-as-a-virtual-webcam">Appendix A OBS as a virtual webcam</a></li><li><a class="table-of-contents__link toc-highlight" href="/aoh-docs/docs/deployment/loadtest-ucs#apart-from-steaming-a-pc-screen-to-major-streaming-sites--obs-can-emulate-a-webcam-onto-the-client-using-the-many-source-capture-tools-the-obs-offers-for-this-test-the-browser-capture-tool-allows-a-user-to-load-a-webpage-directly">Apart from steaming a PC screen to major streaming sites,  OBS can emulate a webcam onto the client using the many source capture tools the OBS offers. For this test, the browser capture tool allows a user to load a webpage directly.</a></li><li><a class="table-of-contents__link toc-highlight" href="/aoh-docs/docs/deployment/loadtest-ucs#appendix-b-why-spawn-ec2-instance-instead-of-spawing-vms-on-local-servers">Appendix B why Spawn EC2 instance instead of spawing VMs on local servers</a></li><li><a class="table-of-contents__link toc-highlight" href="/aoh-docs/docs/deployment/loadtest-ucs#appendix-b-testing-done-in-aws">Appendix B Testing done in AWS</a><ul><li><a class="table-of-contents__link toc-highlight" href="/aoh-docs/docs/deployment/loadtest-ucs#aoh-cluster-setup-used-for-the-test-1">AOH Cluster setup used for the test</a></li></ul></li><li><a class="table-of-contents__link toc-highlight" href="/aoh-docs/docs/deployment/loadtest-ucs#these-are-the-test-setup-1">These are the test setup</a><ul><li><a class="table-of-contents__link toc-highlight" href="/aoh-docs/docs/deployment/loadtest-ucs#ec2-instances-testing-machine">EC2 instances testing machine</a></li><li><a class="table-of-contents__link toc-highlight" href="/aoh-docs/docs/deployment/loadtest-ucs#sfu-configuration-1">SFU configuration</a></li></ul></li><li><a class="table-of-contents__link toc-highlight" href="/aoh-docs/docs/deployment/loadtest-ucs#2-test-steps-1">2 Test steps</a></li><li><a class="table-of-contents__link toc-highlight" href="/aoh-docs/docs/deployment/loadtest-ucs#3-results-1">3 Results</a></li><li><a class="table-of-contents__link toc-highlight" href="/aoh-docs/docs/deployment/loadtest-ucs#3-observations-1">3 Observations</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/mssfoobar" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub Organisation<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.stengg.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">ST Engineering<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 | ST Engineering</div></div></div></footer></div>
</body>
</html>